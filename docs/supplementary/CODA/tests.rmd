---
title: "Results for the test depicted in the paper [Martínez-Minaya et al](https://arxiv.org/abs/1907.04059)"
author: "Joaquín Martínez-Minaya and Finn Lindgren"
date: "`r Sys.Date()`"
linestretch: "1.5"

output:   
  bookdown::html_document2:
  #theme: cerulean
    df_print: paged
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
header-includes:
   - \newcommand{\vekey}[1]{{\boldsymbol{#1}}} %vectors
   - \newcommand{\ve}[1]{{\boldsymbol{#1}}} %vectors


---

```{r, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>", 
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  cache   = FALSE
)
library(dirinla)
library(INLA)
library(dplyr)
library(DirichletReg) #Dirichlet
library(knitr)


```

# Introduction
This document is devoted to depict all the results obtained after the different simulations of the paper [Martinez-Minaya et al., 2021](https://arxiv.org/abs/1907.04059).


# Simulation: Scenario 1
This simula



# Simulation: Scenario 2


# Simulation: Scenario 3



## Data simulation
To conduct the tests, we have simulated different datasets with the following structures.
Each dataset has 4 covariates, one per category and a shared random effect.
\begin{eqnarray}
  \log(\alpha_{1n}) & = & \eta_{1n} = \beta_{1}^1 \cdot v_{1n} + w^1(j_n) \,, \nonumber \\
  \log(\alpha_{2n}) & = & \eta_{2n} = \beta_{1}^2 \cdot v_{2n} + w^1(j_n) \,, \nonumber \\
  \log(\alpha_{3n}) & = & \eta_{3n} = \beta_{1}^3 \cdot v_{3n} + w^2(j_n) \,, \nonumber \\
  \log(\alpha_{4n}) & = & \eta_{4n} = \beta_{1}^4 \cdot v_{4n} + w^2(j_n) \,, \nonumber \\
\end{eqnarray}
where $v_{kn}$ are covariates $k = 1, \ldots, 4$ simulated from a random uniform (-1, 1), and $w^1(j_n)$ and $w^2(j_n)$ are **iid shared random effects**. $j_n = 1, \ldots, J$, being $J$ the levels of the factor.

We simulate datasets with N= 50, 100 and 500; and with different sizes for J. We have fitted the models using Gaussian priors for $\beta$s, Half Normal and pc-priors for $\sigma_1$ and $\sigma_2$. We are going to fit four different models:

1. Short-JAGS with **Half Normal for standard deviations** (mean = 0, sd = 1).

2. dirinla with **pc-priors for standard deviations** (sigma = 10, alpha = 0.01).

3. Long-JAGS with **Half Normal for standard deviations** (mean = 0, sd = 1).

4. dirinla with **Half Normal for standard deviations** (mean = 0, sd = 1).

In order to check the results, we have computed:

- Posterior distributions and have compared it.

- Computational times

- Mean and sd of the fixed effects

- Two measures: $ratio_1$ (closer 0, better is the dirinla fit) and $ratio_2$ (closer 1, better is the dirinla fit), computed for the parameters and hyperparameters:
\begin{eqnarray}\label{eq:ratio1_ratio2}
	ratio_1 & = & (E(\phi_{dirinla}) - E(\phi_{long R-JAGS}))/ SD(\phi_{long R-JAGS})  \,\,, \\
	ratio_2 & = & SD(\phi_{dirinla})/ SD(\phi_{long R-JAGS})  \,\,,
\end{eqnarray}


- $n.eff$ and $Rhat$ for short and long JAGS.



## Results {.tabset}

```{r, results='asis'}
summary_print <- function(N, J)
{
  cat("\n")
  cat(sprintf(paste0("#### J = ", J, "\n")))
  cat("**Parameters** \n")
  cat(paste0("![](IMG/examples_simulation4_slopes_", N, "_", J, "/examples_simulation4_slopes_", N, "_", J, "-1.png){width=100%}"))

  cat("**Hyperparameters** \n ")
  cat(paste0("![](IMG/examples_simulation4_sigma_", N, "_", J, "/examples_simulation4_sigma_", N, "_", J, "-1.png){width=100%} \n \n "))
  cat("<br>")
  if(N<=500)
  {
      a <- readRDS("simulation4_50-500.RDS")
  }else{
      a <- readRDS("simulation4_1000.RDS")
  }
  a <- a[, c(paste0(N, "-", J))]
  
  #Half normal
  # names(a)[c(7,8, 11, 12)] <- c("ratio1_sigma_pc", "ratio2_sigma_pc", "ratio1_sigma_log_hn", "ratio2_sigma_log_hn")
  
  

    
  num <- length(a) - 1
  names_ele <- names(a)
  names(a[[1]]) <- c("JAGS", "dirinla pc", "LONG-JAGS", "dirinla hn")
  names(a[c(13,14)]) <- c("res_check_jags", "res_check_long_jags")
  for (i in 1:num){
    b <- a[i]
    if(i == 2)
    {
      result <- as.numeric(b[[1]]) %>% matrix(., nrow = 4)
      colnames(result) <- colnames(b[[1]])
      colnames(result) <- c("JAGS_mean", "JAGS_sd", "INLA_PC_mean", "INLA_PC_sd", "LONG_JAGS_mean", "LONG_JAGS_sd", "INLA_HN_mean", "INLA_HN_sd")  
      rownames(result) <- rownames(b[[1]])
      
      result %>%  knitr::kable(.,  digits = c(4)) %>% 
        print(.)
    }else{
     cat(paste0("**", names_ele[i], "** \n "))
     b[[1]] %>% as.matrix(.) %>% t(.) %>% knitr::kable(.,  digits = c(4)) %>% print(.)
     cat("\n \n ")
    }
  }
}
```

### N = 50 {.tabset}

```{r, results = 'asis'}
summary_print(N = 50, J = 2)
summary_print(N = 50, J = 5)
summary_print(N = 50, J = 10)
summary_print(N = 50, J = 25)
summary_print(N = 50, J = 50)
```

### N = 100 {.tabset}

```{r, results = 'asis'}
summary_print(N = 100, J = 2)
summary_print(N = 100, J = 5)
summary_print(N = 100, J = 10)
summary_print(N = 100, J = 25)
summary_print(N = 100, J = 100)
```


### N = 500 {.tabset}

```{r, results = 'asis'}
summary_print(N = 500, J = 2)
summary_print(N = 500, J = 5)
summary_print(N = 500, J = 10)
summary_print(N = 500, J = 25)
summary_print(N = 500, J = 500)
```

### N = 1000 {.tabset}

```{r, results = 'asis'}
summary_print(N = 1000, J = 2)
summary_print(N = 1000, J = 5)
summary_print(N = 1000, J = 10)
summary_print(N = 1000, J = 25)
summary_print(N = 1000, J = 1000)
```

<!-- ### N = 100 {.tabset} -->

<!-- ```{r, results = 'asis'} -->
<!-- summary_print(N = 100, J = 5) -->
<!-- summary_print(N = 100, J = 10) -->
<!-- summary_print(N = 100, J = 25) -->
<!-- summary_print(N = 100, J = 50) -->
<!-- ``` -->

<!-- ![](IMG/examples_simulation4_sigma_50_5.png){width=100%}


<!-- ### n = 50 {.tabset} -->

<!-- #### J = 50 -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_slopes_50.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_tau_50.png){width=75%} -->

<!-- #### J = 25  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_slopes_50-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_tau_50-1.png){width=75%} -->

<!-- #### J = 10  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_slopes_50-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_tau_50-1.png){width=75%} -->

<!-- #### J = 5  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_slopes_50-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_tau_50-1.png){width=75%} -->


<!-- #### J = 2  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_slopes_50-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_tau_50-1.png){width=75%} -->


<!-- ### n = 100 {.tabset} -->

<!-- #### J = 100 -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_slopes_100.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_tau_100.png){width=75%} -->

<!-- #### J = 50  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_slopes_100-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_tau_100-1.png){width=75%} -->

<!-- #### J = 20  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_slopes_100-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_tau_100-1.png){width=75%} -->

<!-- #### J = 10  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_slopes_100-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_tau_100-1.png){width=75%} -->


<!-- #### J = 4  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_slopes_100-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_tau_100-1.png){width=75%} -->














<!-- ### n = 300 {.tabset} -->

<!-- #### J = 300 -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_slopes_300.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_tau_300.png){width=75%} -->

<!-- #### J = 150  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_slopes_300-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_tau_300-1.png){width=75%} -->

<!-- #### J = 60  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_slopes_300-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_tau_300-1.png){width=75%} -->

<!-- #### J = 30  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_slopes_300-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_tau_300-1.png){width=75%} -->


<!-- #### J = 12  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_slopes_300-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_tau_300-1.png){width=75%} -->















<!-- ### n = 500 {.tabset} -->

<!-- #### J = 500 -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_slopes_500.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_1/examples_simulation4_tau_500.png){width=75%} -->

<!-- #### J = 250  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_slopes_500-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_2/examples_simulation4_tau_500-1.png){width=75%} -->

<!-- #### J = 100  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_slopes_500-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_5/examples_simulation4_tau_500-1.png){width=75%} -->

<!-- #### J = 50  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_slopes_500-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_10/examples_simulation4_tau_500-1.png){width=75%} -->


<!-- #### J = 20  -->
<!-- **Parameters**  -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_slopes_500-1.png){width=100%} -->

<!-- **Hyperparameters** -->

<!-- ![](IMG/JUST_SLOPES2_25/examples_simulation4_tau_500-1.png){width=75%} -->














